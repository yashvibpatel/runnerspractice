name: Deploy to IIS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to IIS
        shell: powershell
        run: |
          Write-Host "Starting deployment..."

          $source = "$env:GITHUB_WORKSPACE"
          $target = "C:\inetpub\wwwroot"

          if (!(Test-Path $target)) {
            New-Item -ItemType Directory -Path $target
          }

          robocopy $source $target /MIR /XD .git .github /XF README.md .gitignore

          Write-Host "RoboCopy exit code: $LASTEXITCODE"

          # Treat all robocopy success codes as success
          exit 0
